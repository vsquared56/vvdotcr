<div id="submission-dialog" hx-target="this" hx-swap="outerHTML">
  <script>
    function locationError(err) {
      console.log(err);
      htmx.find('#submitLocation').setAttribute('disabled', true);
      htmx.find('#submitLocation').innerHTML = 'Location denied';
    }

    function locationSuccess(event, position) {
      var positionInfo = {
        latitude: position.coords.latitude,
        longitude: position.coords.longitude,
        accuracy: position.coords.accuracy,
        timestamp: position.timestamp
      }

      htmx.find('#latitude').setAttribute('value', position.coords.latitude);
      htmx.find('#longitude').setAttribute('value', position.coords.longitude);
      htmx.find('#accuracy').setAttribute('value', position.coords.accuracy);
      htmx.find('#timestamp').setAttribute('value', position.timestamp);
      event.detail.issueRequest();
    }

    function confirmLocation(event) {
      event.preventDefault();
      navigator.geolocation.getCurrentPosition(function (position) {
        locationSuccess(event, position);
      }, locationError);
    }

  </script>
  <input type="checkbox" id="submission-dialog-modal" class="modal-toggle" checked="true" />
  <div class="modal" role="dialog">
    <div class="modal-box">
      <h3 class="font-bold text-lg">Can we get your location?</h3>
      <p class="py-4">{{error}}</p>
      <div class="modal-action">
        <form id='location'>
          <input id='latitude' name='latitude' type='hidden'>
          <input id='longitude' name='longitude' type='hidden'>
          <input id='accuracy' name='accuracy' type='hidden'>
          <input id='timestamp' name='timestamp' type='hidden'>
          <button id='submitLocation' class='btn btn-primary' hx-post='/api/location-submit?submissionId={{submissionId}}'
            hx-on:htmx:confirm='confirmLocation(event);' hx-target='#submission-dialog'>
            Submit my location
          </button>
          <button id='submitWithoutLocation' class='btn btn-neutral' hx-post='/api/location-submit?submissionId={{submissionId}}'
            hx-target='#submission-dialog'>
            Submit without a location.
          </button>
        </form>
      </div>
    </div>
  </div>
</div>